(function(){var C=YAHOO.util.Dom,A=YAHOO.util.Event,f=YAHOO.util.Element;var z=Alfresco.util.encodeHTML,t=Alfresco.util.combinePaths,s=Alfresco.util.siteURL;var a="org.alfresco.share.documentList",E=a+".hideNavBar";Alfresco.DocListToolbar=function(M){Alfresco.DocListToolbar.superclass.constructor.call(this,"Alfresco.DocListToolbar",M,["button","menu","container"]);this.selectedFiles=[];this.currentFilter={};this.dynamicControls=[];this.doclistMetadata={};this.actionsView="browse";YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("deactivateAllControls",this.onDeactivateAllControls,this);YAHOO.Bubbling.on("deactivateDynamicControls",this.onDeactivateDynamicControls,this);YAHOO.Bubbling.on("selectedFilesChanged",this.onSelectedFilesChanged,this);YAHOO.Bubbling.on("userAccess",this.onUserAccess,this);YAHOO.Bubbling.on("doclistMetadata",this.onDoclistMetadata,this);YAHOO.Bubbling.on("showFileUploadDialog",this.onFileUpload,this);YAHOO.Bubbling.on("dropTargetOwnerRequest",this.onDropTargetOwnerRequest,this);YAHOO.Bubbling.on("documentDragOver",this.onDocumentDragOver,this);YAHOO.Bubbling.on("documentDragOut",this.onDocumentDragOut,this);YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this);return this};YAHOO.extend(Alfresco.DocListToolbar,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.DocListToolbar,Alfresco.doclib.Actions);YAHOO.lang.augmentObject(Alfresco.DocListToolbar.prototype,{options:{siteId:null,containerId:"documentLibrary",groupActivitiesAt:5,hideNavBar:false,googleDocsEnabled:false,repositoryBrowsing:true,useTitle:true},currentPath:"",currentFilter:null,fileUpload:null,selectedFiles:null,folderDetailsUrl:null,dynamicControls:null,doclistMetadata:null,onReady:function B(){if(C.get(this.id+"-createContent-button")){this.widgets.createContent=Alfresco.util.createYUIButton(this,"createContent-button",this.onCreateContent,{type:"menu",menu:"createContent-menu",lazyloadmenu:false,disabled:true,value:"CreateChildren"});var T=this.widgets.createContent.getMenu(),Y=0;if(this.options.createContentActions.length!==0){var P=[],M,W,Q,R,U,X;for(var S=0;S<this.options.createContentActions.length;S++){W=this.options.createContentActions[S];R={parent:T};Q=null;if(W.type=="javascript"){R.onclick={fn:function(ab,aa,ae){var ad=Alfresco.util.deepCopy(this.doclistMetadata.parent);var ac={nodeRef:ad.nodeRef,node:ad,jsNode:new Alfresco.util.Node(ad)};this[ae.params["function"]].call(this,ac)},obj:W,scope:this};Q="#"}else{if(W.type=="pagelink"){Q=s(W.params.page)}else{if(W.type=="link"){Q=W.params.href}}}U='<a href="'+Q+'" rel="'+W.permission+'"><span style="background-image:url('+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+W.icon+'-file-16.png)" class="'+W.icon+'-file">'+this.msg(W.label)+"</span></a>";X=document.createElement("li");X.innerHTML=U;M=new YAHOO.widget.MenuItem(X,R);P.push(M)}T.addItems(P,Y);Y++}if(this.options.createContentByTemplateEnabled){var X=document.createElement("li");X.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-node")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",X,true),"click",function(aa){A.preventDefault(aa);A.stopEvent(aa)});var O=document.createElement("div");O.innerHTML='<div class="bd"><ul></ul></div>';var V=new YAHOO.widget.MenuItem(X,{parent:T,submenu:O});T.addItems([V],Y);Y++;var Z=this.widgets.createContent.getMenu().getSubmenus(),N=Z.length>0?Z[0]:null;if(N){N.subscribe("beforeShow",this.onCreateByTemplateNodeBeforeShow,this,true);N.subscribe("click",this.onCreateByTemplateNodeClick,this,true)}}T.render();this.dynamicControls.push(this.widgets.createContent)}this.widgets.newFolder=Alfresco.util.createYUIButton(this,"newFolder-button",this.onNewFolder,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.newFolder);this.widgets.fileUpload=Alfresco.util.createYUIButton(this,"fileUpload-button",this.onFileUpload,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.fileUpload);this.widgets.syncToCloud=Alfresco.util.createYUIButton(this,"syncToCloud-button",this.onSyncToCloud,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.syncToCloud);this.widgets.unsyncFromCloud=Alfresco.util.createYUIButton(this,"unsyncFromCloud-button",this.onUnsyncFromCloud,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.unsyncFromCloud);this.widgets.scanner=Alfresco.util.createYUIButton(this,"scanner-button",this.onToolbarActionScan,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.scanner);this.widgets.selectedItems=Alfresco.util.createYUIButton(this,"selectedItems-button",this.onSelectedItems,{type:"menu",menu:"selectedItems-menu",lazyloadmenu:false,disabled:true});this.dynamicControls.push(this.widgets.selectedItems);this.widgets.hideNavBar=Alfresco.util.createYUIButton(this,"hideNavBar-button",this.onHideNavBar,{type:"checkbox",checked:!this.options.hideNavBar});if(this.widgets.hideNavBar!==null){this.widgets.hideNavBar.set("title",this.msg(this.options.hideNavBar?"button.navbar.show":"button.navbar.hide"));C.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.dynamicControls.push(this.widgets.hideNavBar)}this.widgets.rssFeed=Alfresco.util.createYUIButton(this,"rssFeed-button",null,{type:"link"});this.dynamicControls.push(this.widgets.rssFeed);this.widgets.folderUp=Alfresco.util.createYUIButton(this,"folderUp-button",this.onFolderUp,{disabled:true,title:this.msg("button.up")});this.dynamicControls.push(this.widgets.folderUp);this.modules.actions=new Alfresco.module.DoclibActions();this.modules.docList=Alfresco.util.ComponentManager.findFirst("Alfresco.DocumentList");this.services.preferences=new Alfresco.service.Preferences();C.setStyle(this.id+"-body","visibility","visible")},onToolbarActionScan:function y(R,Q,P){var O=Alfresco.constants.PROXY_URI+"/scanner/send-doc-to-scan?noderef="+this.doclistMetadata.parent.nodeRef;var M=new Alfresco.module.SimpleDialog(this.id+"-scannerDialog");M.setOptions({width:"30em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/select-scanner",firstFocus:M.id+"-select-scanner",doSetupFormsValidation:{fn:doSetupFormsValidation,scope:this},actionUrl:Alfresco.constants.PROXY_URI+"/scanner/send-doc-to-scan?noderef="+this.doclistMetadata.parent.nodeRef,onSuccess:{fn:function N(S){YAHOO.Bubbling.fire("metadataRefresh",{highlightFile:this.doclistMetadata.parent.displayName});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.scan.success")})},scope:this},onFailure:{message:this.msg("message.scan.failure")}}).show()},onCreateContent:function w(Q,P,O){var N=P[1],M=N.element.getElementsByTagName("a")[0];if(N.parent===this.widgets.createContent.getMenu()&&M&&M.nodeName=="A"){M.href=YAHOO.lang.substitute(M.href,{nodeRef:this.doclistMetadata.parent.nodeRef});if(M.href.indexOf("%7BnodeRef%7D")!==-1){M.href=M.href.replace("%7BnodeRef%7D",encodeURIComponent(this.doclistMetadata.parent.nodeRef))}}},onCreateByTemplateNodeBeforeShow:function D(){var M=this.widgets.createContent.getMenu().getSubmenus()[0];if(M.getItems().length==0){M.clearContent();M.addItem(this.msg("label.loading"));M.render();Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node-templates",successCallback:{fn:function(P,T){var O=P.json.data,S=[],Q;for(var R=0,N=O.length;R<N;R++){node=O[R];Q=z(node.name);if(node.title&&node.title!==node.name&&this.options.useTitle){Q+='<span class="title">('+z(node.title)+")</span>"}S.push({text:'<span title="'+z(node.description)+'">'+Q+"</span>",value:node})}if(S.length==0){S.push(this.msg("label.empty"))}M.clearContent();M.addItems(S);M.render()},scope:this}})}},onCreateByTemplateNodeClick:function H(Q,P,O){var N=P[1].value,M=this.doclistMetadata.parent.nodeRef;if(N){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node-templates",dataObj:{sourceNodeRef:N.nodeRef,parentNodeRef:M},successCallback:{fn:function(R){YAHOO.Bubbling.fire("nodeCreated",{name:N.name,parentNodeRef:M,highlightFile:R.json.name})}},successMessage:this.msg("message.create-content-by-template-node.success",N.name),failureMessage:this.msg("message.create-content-by-template-node.failure",N.name)})}},onNewFolder:function u(Q,T){var S=this.doclistMetadata.parent.nodeRef;var U=function O(V,W){C.get(W.id+"-dialogTitle").innerHTML=this.msg("label.new-folder.title");C.get(W.id+"-dialogHeader").innerHTML=this.msg("label.new-folder.header")};var M=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"type",itemId:"cm:folder",destination:S,mode:"create",submitType:"json",formId:"doclib-common"});var P=new Alfresco.module.SimpleDialog(this.id+"-createFolder");P.setOptions({width:"33em",templateUrl:M,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:U,scope:this},onSuccess:{fn:function R(W){var X;var Y=W.config.dataObj.prop_cm_name;var V=W.json.persistedObject;X={fileName:Y,nodeRef:V,path:this.currentPath+(this.currentPath!=="/"?"/":"")+Y};this.modules.actions.postActivity(this.options.siteId,"folder-added","documentlibrary",X);YAHOO.Bubbling.fire("folderCreated",{name:Y,parentNodeRef:S});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.new-folder.success",Y)})},scope:this},onFailure:{fn:function N(V){if(V){var W=V.config.dataObj.prop_cm_name;Alfresco.util.PopupManager.displayMessage({text:this.msg("message.new-folder.failure",W)})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.failure")})}},scope:this}}).show()},onSyncToCloud:function n(P,Q){var M=new Object();var N=this.doclistMetadata.parent;M.displayName=N.properties["cm:name"];M.nodeRef=N.nodeRef;var O=new Object();O.isContainer=N.isContainer;M.jsNode=O;this.onActionCloudSync(M)},onUnsyncFromCloud:function r(Q,R){var M=new Object();var O=this.doclistMetadata.parent;var P=new Object();P.isContainer=O.isContainer;M.jsNode=P;var N=new Object();N.uri=O.nodeRef.replace(":/","");P.nodeRef=N;M.displayName=O.properties["cm:name"];this.onActionCloudUnsync(M)},onFileUpload:function o(O,P){if(this.fileUpload===null){this.fileUpload=Alfresco.getFileUploadInstance()}var M={siteId:this.options.siteId,containerId:this.options.containerId,uploadDirectory:this.currentPath,filter:[],mode:this.fileUpload.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};this.fileUpload.show(M);if(YAHOO.lang.isArray(P)&&P[1].tooltip){var N=Alfresco.util.createBalloon(this.fileUpload.uploader.id+"-dialog",{html:P[1].tooltip,width:"30em"});N.show();this.fileUpload.uploader.widgets.panel.hideEvent.subscribe(function(){N.hide()})}},onFileUploadWithTooltip:function J(M,N){this.onFileUpload(M,N)},onFileUploadComplete:function x(M){var Q=M.successful.length,N,P;if(Q>0){if(Q<(this.options.groupActivitiesAt||5)){for(var O=0;O<Q;O++){P=M.successful[O];N={fileName:P.fileName,nodeRef:P.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-added","document-details",N)}}else{N={fileCount:Q,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-added","documentlibrary",N)}}},onSelectedItems:function p(R,Q,P){var N=Q[0],O=Q[1];if(this.modules.docList){var M=Alfresco.util.findEventClass(O);if(M&&(typeof this[M]=="function")){this[M].call(this,this.modules.docList.getSelectedFiles())}}A.preventDefault(N)},onActionDelete:function q(M){var R=this,N=[];for(var Q=0,O=M.length;Q<O;Q++){N.push('<span class="'+(M[Q].jsNode.isContainer?"folder":"document")+'">'+z(M[Q].displayName)+"</span>")}var U=this.msg("title.multiple-delete.confirm"),P=this.msg("message.multiple-delete.confirm",M.length);P+='<div class="toolbar-file-list">'+N.join("")+"</div>";Alfresco.util.PopupManager.displayPrompt({title:U,text:P,noEscape:true,modal:true,buttons:[{text:this.msg("button.delete"),handler:function T(){this.destroy();R._onActionDeleteConfirm.call(R,M)}},{text:this.msg("button.cancel"),handler:function S(){this.destroy()},isDefault:true}]})},_onActionDeleteConfirm:function j(M){var R=[],N,Q;for(N=0,Q=M.length;N<Q;N++){R.push(M[N].jsNode.nodeRef.nodeRef)}var P=function O(Y,T){var S;var X=0;var V=0;if(!Y.json.overallSuccess){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.multiple-delete.failure")});return}YAHOO.Bubbling.fire("filesDeleted");for(N=0,Q=Y.json.totalResults;N<Q;N++){S=Y.json.results[N];if(S.success){if(S.type=="folder"){V++}else{X++}YAHOO.Bubbling.fire(S.type=="folder"?"folderDeleted":"fileDeleted",{multiple:true,nodeRef:S.nodeRef})}}if(Alfresco.util.isValueSet(this.options.siteId)){var U;var W=V+X;if(W>0){if(W<this.options.groupActivitiesAt){for(N=0;N<W;N++){U={fileName:Y.json.results[N].id,nodeRef:Y.json.results[N].nodeRef,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};if(Y.json.results[N].type=="folder"){this.modules.actions.postActivity(this.options.siteId,"folder-deleted","documentlibrary",U)}else{this.modules.actions.postActivity(this.options.siteId,"file-deleted","documentlibrary",U)}}}else{if(X>0){U={fileCount:X,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-deleted","documentlibrary",U)}if(V>0){U={fileCount:V,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"folders-deleted","documentlibrary",U)}}}}Alfresco.util.PopupManager.displayMessage({text:this.msg("message.multiple-delete.success",W)})};this.modules.actions.genericAction({success:{callback:{fn:P,scope:this,obj:M}},failure:{message:this.msg("message.multiple-delete.failure")},webscript:{method:Alfresco.util.Ajax.DELETE,name:"files"},wait:{message:this.msg("message.multiple-delete.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:R}}})},onActionDeselectAll:function K(){if(this.modules.docList){this.modules.docList.selectFiles("selectNone")}},onHideNavBar:function L(M,N){this.options.hideNavBar=!this.widgets.hideNavBar.get("checked");this.widgets.hideNavBar.set("title",this.msg(this.options.hideNavBar?"button.navbar.show":"button.navbar.hide"));C.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.services.preferences.set(E,this.options.hideNavBar);if(M){A.preventDefault(M)}},onFolderUp:function h(O,P){var N=this.currentPath.substring(0,this.currentPath.lastIndexOf("/")),M=this.currentFilter;M.filterData=N;YAHOO.Bubbling.fire("changeFilter",M);A.preventDefault(O)},onFilterChanged:function F(Q,R){this._handleSyncButtons();var O=R[1];if(O&&(typeof O.filterId!=="undefined")){O.filterOwner=O.filterOwner||Alfresco.util.FilterManager.getOwner(O.filterId);if(O.filterOwner){if(this.currentFilter.filterOwner!=O.filterOwner||this.currentFilter.filterId!=O.filterId){var V=O.filterOwner.split(".")[1],U=V+"_"+O.filterId;var S=YAHOO.util.Selector.query("div.hideable",C.get(this.id)),M;for(var P=0,N=S.length;P<N;P++){M=S[P];if(C.hasClass(M,V)||C.hasClass(M,U)){C.removeClass(M,"toolbar-hidden")}else{C.addClass(M,"toolbar-hidden")}}}}Alfresco.logger.debug("DLTB_onFilterChanged","Old Filter",this.currentFilter);this.currentFilter=Alfresco.util.cleanBubblingObject(O);Alfresco.logger.debug("DLTB_onFilterChanged","New Filter",this.currentFilter);if(this.currentFilter.filterId=="path"||this.currentFilter.filterId=="category"){this.currentPath=t("/",this.currentFilter.filterData);this._generateBreadcrumb();var T=this.currentPath.split("/");if(this.currentPath==="/"){T=["/"]}if(this.widgets.folderUp){this.widgets.folderUp.set("disabled",T.length<2)}}else{this._generateDescription()}this._generateRSSFeedUrl()}},_handleSyncButtons:function g(){var M=C.get(this.id+"-syncToCloud-button");var Q=C.get(this.id+"-unsyncFromCloud-button");var O=this.doclistMetadata.parent;if(O){var P=O.aspects;if(P){if(Alfresco.util.arrayContains(P,"sync:syncSetMemberNode")){C.removeClass(Q,"hidden");C.addClass(M,"hidden")}else{C.removeClass(M,"hidden");C.addClass(Q,"hidden")}}var N=O.properties;if(N&&(N["cm:name"]==="documentLibrary"||N["sync:directSync"]==="false")||this.options.syncMode!=="ON_PREMISE"){C.addClass(Q,"hidden");C.addClass(M,"hidden")}}},onDeactivateAllControls:function k(O,N){var M,P=Alfresco.util.disableYUIButton;for(M in this.widgets){if(this.widgets.hasOwnProperty(M)){P(this.widgets[M])}}},onDeactivateDynamicControls:function I(O,N){var M,P=Alfresco.util.disableYUIButton;for(M in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(M)){P(this.dynamicControls[M])}}},onUserAccess:function b(S,U){var N=function V(ah,X){var ag,al,aj,Y,ak,ac,af=false,W,aa,ae;if(ah instanceof YAHOO.widget.MenuItem&&ah.element.firstChild){af=true;ag=ah.element.firstChild.rel;W=Alfresco.util.bind(ah.cfg.setProperty,ah.cfg,"className","");aa=Alfresco.util.bind(ah.cfg.setProperty,ah.cfg,"className","hidden")}else{ag=ah.get("value");W=Alfresco.util.bind(ah.set,ah,"disabled",false);aa=Alfresco.util.bind(ah.set,ah,"disabled",true)}W();if(typeof ag=="string"&&ag!==""){al=ag.split(",");for(var ab=0,ai=al.length;ab<ai;ab++){if(al[ab].indexOf("|")!==-1){ac=false;aj=al[ab].split("|");for(var Z=0,ad=aj.length;Z<ad;Z++){Y=aj[Z].split(":");ak=Y[0];ae=Y.length==2?Y[1]=="true":true;if((X[ak]&&ae)||(!X[ak]&&!ae)){ac=true;if(!af){ah.set("activePermission",aj[Z],true)}break}}if(!ac){aa();break}}else{Y=al[ab].split(":");ak=Y[0];ae=Y.length==2?Y[1]=="true":true;if((X[ak]&&!ae)||(!X[ak]&&ae)){aa();break}}}}};var P=U[1];if(P&&P.userAccess){var Q,T,M;for(T in this.widgets){if(this.widgets.hasOwnProperty(T)){Q=this.widgets[T];if(Q&&Q.get("srcelement").className!="no-access-check"){N(Q,P.userAccess);if(Q.getMenu()!==null){M=Q.getMenu().getItems();for(var O=0,R=M.length;O<R;O++){N(M[O],P.userAccess)}}}}}}},onSelectedFilesChanged:function G(ai,P){if(this.modules.docList){var T=this.modules.docList.getSelectedFiles(),O=[],af,Q,ag={},ae,U,aj=this.widgets.selectedItems.getMenu().getItems(),S,N,W,Z,R,V=[],ah=[],ab,X,aa,ad;var ac=function ac(ak){return(ak.node.isContainer?"folder":"document")};for(ab=0,X=T.length;ab<X;ab++){af=T[ab];ae=af.node.permissions.user;for(U in ae){if(ae.hasOwnProperty(U)){ag[U]=(ag[U]===undefined?ae[U]:ag[U]&&ae[U])}}Q=ac(af);if(!(Q in O)){O[Q]=true;O.push(Q)}if(ab===0){V=Alfresco.util.deepCopy(af.node.aspects)}else{for(aa=0,ad=V.length;aa<ad;aa++){if(!Alfresco.util.arrayContains(af.node.aspects,V[aa])){Alfresco.util.arrayRemove(V,V[aa])}}}for(aa=0,ad=af.node.aspects.length;aa<ad;aa++){if(!Alfresco.util.arrayContains(ah,af.node.aspects[aa])){ah.push(af.node.aspects[aa])}}}for(U in aj){if(aj.hasOwnProperty(U)){S=aj[U];R=false;if(S.element.firstChild){if(S.element.firstChild.rel&&S.element.firstChild.rel!==""){N=S.element.firstChild.rel.split(",");for(ab=0,X=N.length;ab<X;ab++){if(!ag[N[ab]]){R=true;break}}}var M=C.getAttribute(S.element.firstChild,"data-has-aspects");if(M&&M!==""){M=M.split(",");for(ab=0,X=M.length;ab<X;ab++){if(!Alfresco.util.arrayContains(V,M[ab])){R=true;break}}}var Y=C.getAttribute(S.element.firstChild,"data-not-aspects");if(Y&&Y!==""){Y=Y.split(",");for(ab=0,X=Y.length;ab<X;ab++){if(Alfresco.util.arrayContains(ah,Y[ab])){R=true;break}}}if(!R){if(S.element.firstChild.type&&S.element.firstChild.type!==""){W=S.element.firstChild.type.split("|");for(ab=0;ab<W.length;ab++){Z=Alfresco.util.arrayToObject(W[ab].split(","));for(aa=0,ad=O.length;aa<ad;aa++){if(!(O[aa] in Z)){W.splice(ab,1);--ab;break}}}R=(W.length===0)}}S.cfg.setProperty("disabled",R)}}}this.widgets.selectedItems.set("disabled",(T.length===0))}},onDoclistMetadata:function v(N,M){var O=M[1];this.folderDetailsUrl=null;if(O&&O.metadata){this.doclistMetadata=Alfresco.util.deepCopy(O.metadata);if(O.metadata.parent&&O.metadata.parent.nodeRef){this.folderDetailsUrl=s("folder-details?nodeRef="+O.metadata.parent.nodeRef)}}},onDropTargetOwnerRequest:function d(Q,R){if(R&&R[1]&&R[1].elementId){var T=C.get(R[1].elementId);var M=C.get(this.id+"-breadcrumb");if(C.isAncestor(M,T)){var N="";var U=this.currentPath.split("/");for(var P=0,O=M.children.length;P<O;P++){if(P%2==0){N=N+"/"+U[P/2]}if(T==M.children[P]){break}}var S=this.doclistMetadata.container+N;R[1].callback.call(R[1].scope,S,N)}}},onDocumentDragOver:function c(P,O){if(O&&O[1]&&O[1].elementId){var N=C.get(O[1].elementId);var M=C.get(this.id+"-breadcrumb");if(C.isAncestor(M,N)){C.addClass(N,"documentDragOverHighlight");var R=C.getFirstChild(N);if(R!=null&&R.tagName!="SPAN"){var Q=document.createElement("span");C.addClass(Q,"documentDragOverArrow");C.insertBefore(Q,R)}}}},onDocumentDragOut:function l(P,O){if(O&&O[1]&&O[1].elementId){var N=C.get(O[1].elementId);var M=C.get(this.id+"-breadcrumb");if(C.isAncestor(M,N)){C.removeClass(N,"documentDragOverHighlight");var Q=C.getFirstChild(N);if(Q!=null&&Q.tagName=="SPAN"){N.removeChild(Q)}}}},_generateBreadcrumb:function m(){var T=C.get(this.id+"-breadcrumb");if(T===null){return}T.innerHTML="";var ab=this.currentPath.split("/");if(this.currentPath==="/"){ab=["/"]}var U=this,W=ab.concat();W[0]=Alfresco.util.message("node.root",this.currentFilter.filterOwner);var V=function N(ae,ad){C.addClass(ae.target.parentNode,"highlighted");A.stopEvent(ae)};var ac=function Q(af,ae){var ad=U.currentFilter;ad.filterData=ae;YAHOO.Bubbling.fire("changeFilter",ad);A.stopEvent(af)};var Z=new f(T),R,S,M,aa;for(var P=0,O=ab.length;P<O;++P){R=ab.slice(0,P+1).join("/");S=new f(document.createElement("div"));S.addClass("crumb");S.addClass("documentDroppable");S.addClass("documentDroppableHighlights");if(P>0){M=new f(document.createElement("a"),{href:"#",innerHTML:"&nbsp;"});M.on("click",ac,R);M.addClass("icon");M.addClass("filter-"+z(this.currentFilter.filterId));S.appendChild(M)}if(O-P<2){aa=new f(document.createElement("span"),{innerHTML:(this.folderDetailsUrl)?'<a href="'+this.folderDetailsUrl+'">'+z(W[P])+"</a>":z(W[P])});aa.addClass("label");S.appendChild(aa);Z.appendChild(S)}else{aa=new f(document.createElement("a"),{href:"",innerHTML:z(W[P])});aa.addClass("folder");aa.on("click",ac,R);S.appendChild(aa);Z.appendChild(S);Z.appendChild(new f(document.createElement("div"),{innerHTML:"&gt;",className:"separator"}))}}var Y=C.get(this.id+"-breadcrumb");var X=C.getElementsByClassName("crumb","div",Y);for(var P=0,O=X.length;P<O;P++){new YAHOO.util.DDTarget(X[P])}},_generateDescription:function e(){var O,R,N,M,P;O=C.get(this.id+"-description");if(O===null){return}while(O.hasChildNodes()){O.removeChild(O.lastChild)}P=typeof this.currentFilter.filterDisplay!=="undefined"?this.currentFilter.filterDisplay:(this.currentFilter.filterData||"");N=new f(document.createElement("div"),{innerHTML:this.msg("description."+this.currentFilter.filterId,P)});N.addClass("message");var S="description."+this.currentFilter.filterId+".more",Q=S+".filterDisplay";if(P!==""&&this.msg(Q)!==Q){S=Q}M=new f(document.createElement("span"),{innerHTML:this.msg(S,z(P))});M.addClass("more");N.appendChild(M);R=new f(O);R.appendChild(N)},_generateRSSFeedUrl:function i(){if(this.widgets.rssFeed&&this.modules.docList){var M=YAHOO.lang.substitute("{type}/site/{site}/{container}{path}",{type:this.modules.docList.options.showFolders?"all":"documents",site:encodeURIComponent(this.options.siteId),container:encodeURIComponent(this.options.containerId),path:Alfresco.util.encodeURIPath(this.currentPath)});M+="?filter="+encodeURIComponent(this.currentFilter.filterId);if(this.currentFilter.filterData){M+="&filterData="+encodeURIComponent(this.currentFilter.filterData)}M+="&format=rss";this.widgets.rssFeed.set("href",Alfresco.constants.URL_FEEDSERVICECONTEXT+"components/documentlibrary/feed/"+M);Alfresco.util.enableYUIButton(this.widgets.rssFeed)}}},true)})();